<script>
	const model =
		{
			name: "LevelCrossing",
			objects: [
				{
					name: "train",
					behavior: String.raw`
						state "Idle" as Idle {
						}
						state "Far" as Far {
						}
						state "Close" as Close {
						}
						state "Passing" as Passing {
						}
						[*] -> Idle as "Initial_To_Idle" :    / 
						Idle -> Far as "Idle_To_Far" :    / activation0();
						Far -> Close as "Far_To_Close" :    / activation1();
						Close -> Passing as "Close_To_Passing" : authorization   / 
						Passing -> Idle as "Passing_To_Idle" :    / activation2();
					`,
				},
				{
					name: "tcEntrance0",
					behavior: String.raw`
						state "Detection" as Detection {
						}
						[*] -> Detection as "Initial_To_Detection" :    / 
						Detection -> Detection as "Detection_To_Detection" : activation0   / entranceDetection();
					`,
				},
				{
					name: "tcEntrance1",
					behavior: String.raw`
						state "Detection" as Detection {
						}
						[*] -> Detection as "Initial_To_Detection" :    / 
						Detection -> Detection as "Detection_To_Detection" : activation1   / entranceDetection();
					`,
				},
				{
					name: "tcExit",
					behavior: String.raw`
						state "Detection" as Detection {
						}
						[*] -> Detection as "Initial_To_Detection" :    / 
						Detection -> Detection as "Detection_To_Detection" : activation2   / exitDetection();
					`,
				},
				{
					name: "controller",
					behavior: String.raw`
						state "Idle" as Idle {
						}
						state "WaitRoadSignOn" as WaitRoadSignOn {
						}
						state "FarDetection" as FarDetection {
						}
						state "CloseDetection" as CloseDetection {
						}
						state "WaitRailwaySignOn" as WaitRailwaySignOn {
						}
						state "WaitGateOpen" as WaitGateOpen {
						}
						state "WaitRoadSignOff" as WaitRoadSignOff {
						}
						[*] -> Idle as "Initial_To_Idle" :    / nbEngagedTrains = 0;
						Idle -> WaitRoadSignOn as "Idle_To_WaitRoadSignOn" : entranceDetection  [nbEngagedTrains == 0] / switchRoadSignOn()
						WaitRoadSignOn -> FarDetection as "WaitRoadSignOn_To_FarDetection" : roadSignOn   / 
						FarDetection -> CloseDetection as "FarDetection_To_CloseDetection" : entranceDetection   / close(); nbEngagedTrains++;
						CloseDetection -> Idle as "CloseDetection_To_Idle" : gateClosed   / switchRailwaySignOff();
						Idle -> WaitRailwaySignOn as "Idle_To_WaitRailwaySignOn" : exitDetection  [nbEngagedTrains == 1] / switchRailwaySignOn();
						WaitRailwaySignOn -> WaitGateOpen as "WaitRailwaySignOn_To_WaitGateOpen" : railwaySignOn  [nbEngagedTrains == 1] / open(); nbEngagedTrains--;
						WaitGateOpen -> WaitRoadSignOff as "WaitGateOpen_To_WaitRoadSignOff" : gateOpen   / switchRoadSignOff();
						WaitRoadSignOff -> Idle as "WaitRoadSignOff_To_Idle" : roadSignOff   /
					`,
				},
				{
					name: "railwaySign",
					behavior: String.raw`
						state "Active" as Active {
						}
						state "Inactive" as Inactive {
						}
						[*] -> Active as "Initial_To_Active" :    / 
						Active -> Inactive as "Active_To_Inactive" : switchRailwaySignOff   / authorization();
						Inactive -> Active as "Inactive_To_Active" : switchRailwaySignOn   / railwaySignOn();
					`,
				},
				{
					name: "roadSign",
					behavior: String.raw`
						state "Inactive" as Inactive {
						}
						state "Active" as Active {
						}
						[*] -> Inactive as "Initial_To_Inactive" :    / 
						Inactive -> Active as "Inactive_To_Active" : switchRoadSignOn   / roadSignOn();
						Active -> Inactive as "Active_To_Inactive" : switchRoadSignOff   / roadSignOff();
					`,
				},
				{
					name: "gate",
					behavior: String.raw`
						state "Open" as Open {
						}
						state "Closed" as Closed {
						}
						[*] -> Open as "Initial_To_Open" :    / 
						Open -> Closed as "Open_To_Closed" : close   / gateClosed();
						Closed -> Open as "Closed_To_Open" : open   / gateOpen();
					`,
				},
			],
			connectorByName: {
				C1: {
					ends: [
						"controller",
						"gate",
					],
					possibleMessages: {
						forward: [
							"open",
							"close",
						],
						reverse: [
							"gateOpen",
							"gateClosed",
						],
					},
				},
				C2_0: {
					ends: [
						"controller",
						"tcEntrance0",
					],
					possibleMessages: {
						reverse: [
							"entranceDetection",
						],
					},
				},
				C2_1: {
					ends: [
						"controller",
						"tcEntrance1",
					],
					possibleMessages: {
						reverse: [
							"entranceDetection",
						],
					},
				},
				C3: {
					ends: [
						"controller",
						"tcExit",
					],
					possibleMessages: {
						reverse: [
							"exitDetection",
						],
					},
				},
				C4: {
					ends: [
						"controller",
						"roadSign",
					],
					possibleMessages: {
						forward: [
							"switchRoadSignOn",
							"switchRoadSignOff",
						],
						reverse: [
							"roadSignOn",
							"roadSignOff",
						],
					},
				},
				C5_0: {
					ends: [
						"train",
						"tcEntrance0",
					],
					possibleMessages: {
						forward: [
							"entrance0",
						],
					},
				},
				C5_1: {
					ends: [
						"train",
						"tcEntrance1",
					],
					possibleMessages: {
						forward: [
							"entrance1",
						],
					},
				},
				C6: {
					ends: [
						"train",
						"tcExit",
					],
					possibleMessages: {
						forward: [
							"entrance2",
						],
					},
				},
				C7: {
					ends: [
						"controller",
						"railwaySign",
					],
					possibleMessages: {
						forward: [
							"switchRailwaySignOn",
							"switchRailwaySignOff",
						],
						reverse: [
							"railwaySignOn",
							"railwaySignOff",
						],
					},
				},
				C8: {
					ends: [
						"train",
						"railwaySign",
					],
					possibleMessages: {
						reverse: [
							"authorization",
						],
					},
				},
			},
		}
	;
	document.write(`
		<iframe width="100%" height="100%" src='http://172.24.2.1/AnimUML.html#${encodeURIComponent(JSON.stringify(model)).replace(/'/g, '%27')}'></iframe>
	`);
</script>